---
title: File Upload
description: A composable, accessible file upload component with drag-and-drop, validation, and progress support.
icon: Upload
---

import {
  FileUpload,
  FileUploadSimple,
  formatFileSize,
  useFileUploadWithUploader,
} from "@px-ui/core";
import { ComponentPreview } from "../../../src/components/component-preview";
import {
  BasicDropzoneDemo,
  SingleImageUploadDemo,
  AvatarUploadDemo,
  MultipleImagesGridDemo,
  MultipleFilesListDemo,
  CompactUploadDemo,
  UploadWithProgressDemo,
  InlineImageUploadDemo,
  FilesTableDemo,
  MixedContentCardsDemo,
  DropzoneSizesDemo,
  SimpleUploadDemo,
  SimpleUploadWithS3Demo,
  SimpleButtonVariantDemo,
  SimpleImageGridDemo,
} from "../../../src/components/file-upload-demos";

## Overview

A flexible file upload solution with two approaches:

- **`FileUpload.*`** - Composable components for full customization
- **`FileUploadSimple`** - Ready-to-use component with built-in upload support

## Installation

```bash
npm install @px-ui/core
```

## Import

```tsx
// Composable components
import { FileUpload, formatFileSize } from "@px-ui/core";

// Simple component with upload support
import { FileUploadSimple, useFileUploadWithUploader } from "@px-ui/core";
```

---

## FileUploadSimple (Recommended)

For most use cases, use `FileUploadSimple` - a ready-to-use component with built-in upload support.

### Basic Dropzone

A simple dropzone without upload configuration - useful for client-side file handling.

<ComponentPreview>
  <SimpleUploadDemo />
</ComponentPreview>

```tsx
<FileUploadSimple
  accept="image/*,.pdf,.doc,.docx"
  maxSize={10 * 1024 * 1024}
  onFilesChange={(files) => console.log("Files changed:", files)}
/>
```

---

### With S3 Upload

Auto-upload files to S3 with presigned URLs and progress tracking.

<ComponentPreview>
  <SimpleUploadWithS3Demo />
</ComponentPreview>

```tsx
import { FileUploadSimple } from "@px-ui/core";

function MyUploader() {
  return (
    <FileUploadSimple
      accept="image/*,.pdf"
      multiple
      maxFiles={5}
      maxSize={5 * 1024 * 1024}
      upload={{
        getPresignedUrl: async ({ filename, contentType, size }) => {
          const response = await fetch("/api/get-upload-url", {
            method: "POST",
            body: JSON.stringify({ filename, contentType, size }),
          });
          const data = await response.json();
          return { result: { url: data.url, fullPath: data.fullPath } };
        },
        uploadFile: async (url, file, presignedData, onProgress) => {
          // Upload with progress tracking
          await uploadWithProgress(url, file, onProgress);
          return { result: { url: presignedData.fullPath } };
        },
        onUploadComplete: (file) => console.log("Uploaded:", file),
        onUploadError: (file, error) => console.error("Failed:", file, error),
      }}
      onFilesChange={(files) => console.log("Files:", files)}
    />
  );
}
```

---

### Variants

`FileUploadSimple` supports three variants: `dropzone`, `button`, and `compact`.

<ComponentPreview>
  <SimpleButtonVariantDemo />
</ComponentPreview>

```tsx
// Dropzone (default) - Full drag-and-drop area
<FileUploadSimple variant="dropzone" upload={{ ... }} />

// Button - Simple upload button
<FileUploadSimple
  variant="button"
  buttonText="Upload Files"
  multiple
  upload={{ ... }}
/>

// Compact - Inline button with filename display
<FileUploadSimple
  variant="compact"
  accept=".pdf,.doc,.docx"
  upload={{ ... }}
/>
```

---

### Image Grid Display

For image uploads, show a grid instead of a list.

<ComponentPreview>
  <SimpleImageGridDemo />
</ComponentPreview>

```tsx
<FileUploadSimple
  accept="image/*"
  multiple
  maxFiles={8}
  showImageGrid
  size="sm"
  dropzoneText="Drop images here"
  buttonText="Select images"
  upload={{
    getPresignedUrl: yourGetPresignedUrlFn,
    uploadFile: yourUploadFileFn,
  }}
/>
```

---

### Without Auto-Upload

Disable auto-upload to manually control when files are uploaded:

```tsx
function ManualUpload() {
  const [state, actions] = useFileUploadWithUploader({
    multiple: true,
    upload: {
      autoUpload: false, // Disable auto-upload
      getPresignedUrl: async (params) => { ... },
      uploadFile: async (url, file, data, onProgress) => { ... },
    },
  });

  return (
    <div>
      <FileUploadSimple
        multiple
        upload={{
          autoUpload: false,
          getPresignedUrl: yourGetPresignedUrlFn,
          uploadFile: yourUploadFileFn,
        }}
      />
      <button onClick={() => actions.uploadFiles()}>
        Upload All
      </button>
    </div>
  );
}
```

### FileUploadSimple Props

| Prop             | Type                                  | Default                             | Description                     |
| ---------------- | ------------------------------------- | ----------------------------------- | ------------------------------- |
| `variant`        | `'dropzone' \| 'button' \| 'compact'` | `'dropzone'`                        | Visual layout variant           |
| `size`           | `'sm' \| 'default' \| 'lg'`           | `'default'`                         | Dropzone size                   |
| `dropzoneText`   | `string`                              | `'Paste Or Drag & Drop Files Here'` | Dropzone text                   |
| `buttonText`     | `string`                              | `'Browse for files'`                | Button text                     |
| `showFileList`   | `boolean`                             | `true`                              | Show file list                  |
| `showImageGrid`  | `boolean`                             | `false`                             | Show image grid instead of list |
| `accept`         | `string`                              | `'*'`                               | Accepted file types             |
| `multiple`       | `boolean`                             | `false`                             | Allow multiple files            |
| `maxSize`        | `number`                              | -                                   | Max file size in bytes          |
| `maxFiles`       | `number`                              | -                                   | Max number of files             |
| `disabled`       | `boolean`                             | `false`                             | Disable the upload              |
| `upload`         | `UploadConfig`                        | -                                   | Upload configuration            |
| `onFilesChange`  | `(files) => void`                     | -                                   | Called when files change        |
| `onError`        | `(error) => void`                     | -                                   | Error callback                  |
| `renderFileItem` | `(file, actions) => ReactNode`        | -                                   | Custom file item renderer       |

---

## useFileUploadWithUploader Hook

For full control, use the hook directly:

```tsx
import { useFileUploadWithUploader } from "@px-ui/core";

function CustomUploader() {
  const [state, actions] = useFileUploadWithUploader({
    maxFiles: 5,
    maxSize: 10 * 1024 * 1024,
    accept: "image/*,.pdf",
    multiple: true,
    upload: {
      autoUpload: true,
      getPresignedUrl: async ({ filename, contentType, size }) => {
        // Return { result: { url, fullPath }, error? }
      },
      uploadFile: async (url, file, presignedData, onProgress) => {
        // Return { result: { url }, error? }
      },
      onUploadComplete: (file) => {},
      onUploadError: (file, error) => {},
      onAllUploadsComplete: (files) => {},
    },
  });

  const { files, isDragging, errors, isUploading } = state;
  const {
    addFiles,
    removeFile,
    clearFiles,
    uploadFiles,
    retryUpload,
    cancelUpload,
    getInputProps,
    openFileDialog,
    handleDragEnter,
    handleDragLeave,
    handleDragOver,
    handleDrop,
  } = actions;

  return (
    <div
      onDragEnter={handleDragEnter}
      onDragLeave={handleDragLeave}
      onDragOver={handleDragOver}
      onDrop={handleDrop}
    >
      <input {...getInputProps()} className="sr-only" />
      <button onClick={openFileDialog}>Select Files</button>

      {files.map((file) => (
        <div key={file.id}>
          <span>{file.file.name}</span>
          <span>{file.status}</span>
          {file.status === "uploading" && <span>{file.progress}%</span>}
          {file.status === "error" && (
            <button onClick={() => retryUpload(file.id)}>Retry</button>
          )}
          <button onClick={() => removeFile(file.id)}>Remove</button>
        </div>
      ))}
    </div>
  );
}
```

### Hook Return Types

```tsx
// State
interface FileUploadWithUploaderState {
  files: FileWithUploadStatus[];
  isDragging: boolean;
  errors: string[];
  isUploading: boolean;
}

// File with upload status
interface FileWithUploadStatus {
  id: string;
  file: File | FileMetadata;
  preview?: string;
  progress: number;
  status: "idle" | "uploading" | "success" | "error";
  error?: string;
  uploadedUrl?: string;
}

// Upload config
interface UploadConfig {
  getPresignedUrl: (params: {
    filename: string;
    contentType: string;
    size: number;
  }) => Promise<{
    result?: { url: string; fullPath: string };
    error?: unknown;
  }>;

  uploadFile: (
    url: string,
    file: File,
    presignedData: PresignedUrlResponse,
    onProgress?: (progress: number) => void,
  ) => Promise<{ result?: { url: string }; error?: unknown }>;

  autoUpload?: boolean; // Default: true
  onUploadComplete?: (file: FileWithUploadStatus) => void;
  onUploadError?: (file: FileWithUploadStatus, error: unknown) => void;
  onAllUploadsComplete?: (files: FileWithUploadStatus[]) => void;
}
```

---

## Composable Components (FileUpload.\*)

For full customization, use the composable component API:

## Examples

### Basic Dropzone

The default dropzone with drag-and-drop, paste, and browse button.

<ComponentPreview>
  <BasicDropzoneDemo />
</ComponentPreview>

```tsx
<FileUpload.Root onValueChange={(files) => console.log(files)}>
  <FileUpload.Dropzone />
</FileUpload.Root>
```

---

### Single Image Upload with Preview

Upload a single image with full-size preview overlay.

<ComponentPreview>
  <SingleImageUploadDemo />
</ComponentPreview>

```tsx
function SingleImageUpload() {
  const [files, setFiles] = React.useState([]);

  return (
    <FileUpload.Root
      value={files}
      onValueChange={setFiles}
      accept="image/*"
      maxSize={5 * 1024 * 1024}
    >
      {files.length === 0 ? (
        <FileUpload.Dropzone
          size="sm"
          dropzoneText="Drop your image here"
          browseText="Select image"
        />
      ) : (
        <div className="relative">
          <img
            src={files[0].preview}
            alt={files[0].file.name}
            className="rounded-ppx-m h-48 w-full object-cover"
          />
          <button
            onClick={() => setFiles([])}
            className="absolute right-2 top-2 rounded-full bg-black/60 p-2 text-white"
          >
            ✕
          </button>
        </div>
      )}
    </FileUpload.Root>
  );
}
```

---

### Avatar Upload

Circular avatar upload with hover state.

<ComponentPreview>
  <AvatarUploadDemo />
</ComponentPreview>

```tsx
function AvatarUpload() {
  const [files, setFiles] = React.useState([]);

  return (
    <FileUpload.Root value={files} onValueChange={setFiles} accept="image/*">
      <FileUpload.Dropzone
        hideDefaultContent
        className="size-32 min-h-0 rounded-full p-0"
      >
        {files.length > 0 ? (
          <img
            src={files[0].preview}
            alt="Avatar"
            className="size-full rounded-full object-cover"
          />
        ) : (
          <div className="text-ppx-neutral-10 flex flex-col items-center">
            <UserIcon className="size-10" />
            <span className="text-xs">Upload</span>
          </div>
        )}
      </FileUpload.Dropzone>
    </FileUpload.Root>
  );
}
```

---

### Multiple Images with Grid

Upload multiple images displayed in a responsive grid.

<ComponentPreview>
  <MultipleImagesGridDemo />
</ComponentPreview>

```tsx
<FileUpload.Root multiple accept="image/*" maxFiles={8}>
  <FileUpload.Dropzone size="sm" />
  <div className="mt-4 flex items-center justify-between">
    <span>Uploaded ({files.length}/8)</span>
    <FileUpload.ClearButton>Remove all</FileUpload.ClearButton>
  </div>
  <FileUpload.ImageGrid className="grid-cols-4 gap-2">
    {(files) =>
      files.map((file) => (
        <FileUpload.ImageGridItem key={file.id} file={file} />
      ))
    }
  </FileUpload.ImageGrid>
</FileUpload.Root>
```

---

### Multiple Files with List

Upload multiple files with detailed list view.

<ComponentPreview>
  <MultipleFilesListDemo />
</ComponentPreview>

```tsx
<FileUpload.Root multiple maxFiles={10}>
  <FileUpload.Dropzone />
  <FileUpload.ItemList>
    {(files) =>
      files.map((file) => (
        <FileUpload.Item key={file.id} file={file}>
          <FileUpload.ItemPreview />
          <div className="flex flex-col">
            <FileUpload.ItemName />
            <FileUpload.ItemSize />
          </div>
          <FileUpload.ItemRemove />
        </FileUpload.Item>
      ))
    }
  </FileUpload.ItemList>
</FileUpload.Root>
```

---

### Compact Button Upload

A simple button trigger without dropzone.

<ComponentPreview>
  <CompactUploadDemo />
</ComponentPreview>

```tsx
<FileUpload.Root accept=".pdf,.doc,.docx">
  <div className="flex items-center gap-3">
    <FileUpload.Trigger variant="outline" size="sm">
      <UploadIcon className="size-4" />
      Upload document
    </FileUpload.Trigger>
    {files.length > 0 && <span>{files[0].file.name}</span>}
  </div>
</FileUpload.Root>
```

---

### Upload with Progress

Files with upload progress indicator.

<ComponentPreview>
  <UploadWithProgressDemo />
</ComponentPreview>

```tsx
function UploadWithProgress() {
  const [files, setFiles] = React.useState([]);

  const handleUpload = async (newFiles) => {
    setFiles(newFiles);

    // Simulate upload progress
    for (const file of newFiles) {
      for (let progress = 0; progress <= 100; progress += 5) {
        await new Promise((r) => setTimeout(r, 100));
        setFiles((prev) =>
          prev.map((f) => (f.id === file.id ? { ...f, progress } : f)),
        );
      }
    }
  };

  return (
    <FileUpload.Root value={files} onValueChange={handleUpload} multiple>
      <FileUpload.Dropzone size="sm" />
      <FileUpload.ItemList>
        {(files) =>
          files.map((file) => (
            <FileUpload.Item key={file.id} file={file}>
              <FileUpload.ItemPreview />
              <div className="flex flex-1 flex-col gap-1">
                <div className="flex justify-between">
                  <FileUpload.ItemName />
                  <span>{file.progress}%</span>
                </div>
                <FileUpload.ItemProgress />
              </div>
              <FileUpload.ItemRemove />
            </FileUpload.Item>
          ))
        }
      </FileUpload.ItemList>
    </FileUpload.Root>
  );
}
```

---

### Inline Image Upload

Compact inline image picker with add button.

<ComponentPreview>
  <InlineImageUploadDemo />
</ComponentPreview>

```tsx
<FileUpload.Root accept="image/*" multiple maxFiles={4}>
  <div className="flex flex-wrap gap-2">
    {files.map((file) => (
      <div key={file.id} className="rounded-ppx-s relative size-16">
        <img src={file.preview} className="size-full object-cover" />
        <button onClick={() => removeFile(file.id)}>✕</button>
      </div>
    ))}
    {files.length < 4 && (
      <FileUpload.Dropzone
        hideDefaultContent
        className="rounded-ppx-s size-16 min-h-0 border-2 border-dashed p-0"
      >
        <PlusIcon className="size-6" />
      </FileUpload.Dropzone>
    )}
  </div>
</FileUpload.Root>
```

---

### Files Table

Display uploaded files in a table format.

<ComponentPreview>
  <FilesTableDemo />
</ComponentPreview>

```tsx
<FileUpload.Root multiple>
  <FileUpload.Dropzone size="sm" />
  <div className="rounded-ppx-s border">
    <div className="bg-ppx-neutral-2 flex justify-between p-2">
      <span>Files ({files.length})</span>
      <FileUpload.Trigger size="sm">Add files</FileUpload.Trigger>
    </div>
    <table className="w-full">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Size</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {files.map((file) => (
          <tr key={file.id}>
            <td>{file.file.name}</td>
            <td>{getExtension(file.file.name)}</td>
            <td>{formatFileSize(file.file.size)}</td>
            <td>
              <button onClick={() => removeFile(file.id)}>Delete</button>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</FileUpload.Root>
```

---

### Mixed Content Cards

Display mixed file types in card grid.

<ComponentPreview>
  <MixedContentCardsDemo />
</ComponentPreview>

```tsx
<FileUpload.Root multiple>
  <FileUpload.Dropzone size="sm" />
  <div className="grid grid-cols-2 gap-3">
    {files.map((file) => (
      <div key={file.id} className="rounded-ppx-s border">
        {file.preview ? (
          <img src={file.preview} className="h-24 w-full object-cover" />
        ) : (
          <div className="flex h-24 items-center justify-center">
            <FileIcon type={file.file.type} />
          </div>
        )}
        <div className="p-2">
          <p className="truncate text-sm">{file.file.name}</p>
          <p className="text-ppx-neutral-10 text-xs">
            {formatFileSize(file.file.size)}
          </p>
        </div>
      </div>
    ))}
  </div>
</FileUpload.Root>
```

---

### Dropzone Sizes

Available size variants for the dropzone.

<ComponentPreview className="min-h-[600px]">
  <DropzoneSizesDemo />
</ComponentPreview>

```tsx
<FileUpload.Dropzone size="sm" />  // Small
<FileUpload.Dropzone size="default" />  // Default
<FileUpload.Dropzone size="lg" />  // Large
```

---

## Component Parts

| Component                  | Description                                    |
| -------------------------- | ---------------------------------------------- |
| `FileUpload.Root`          | Context provider, manages state and validation |
| `FileUpload.Dropzone`      | Drag-and-drop area with default UI             |
| `FileUpload.Trigger`       | Standalone button to open file picker          |
| `FileUpload.ItemList`      | Container for file items                       |
| `FileUpload.Item`          | Individual file item wrapper                   |
| `FileUpload.ItemPreview`   | Thumbnail/preview for files                    |
| `FileUpload.ItemName`      | File name display                              |
| `FileUpload.ItemSize`      | File size display                              |
| `FileUpload.ItemRemove`    | Remove file button                             |
| `FileUpload.ItemProgress`  | Progress bar for uploads                       |
| `FileUpload.ClearButton`   | Remove all files button                        |
| `FileUpload.ImageGrid`     | Grid layout for images                         |
| `FileUpload.ImageGridItem` | Image grid item with remove                    |

---

## Validation

### File Type Restriction

```tsx
<FileUpload.Root
  accept="image/*,.pdf"
  onError={(error) => console.error(error.message)}
>
  <FileUpload.Dropzone />
</FileUpload.Root>
```

### File Size Limit

```tsx
<FileUpload.Root
  maxSize={5 * 1024 * 1024} // 5MB
  onError={(error) => console.error(error.message)}
>
  <FileUpload.Dropzone />
</FileUpload.Root>
```

### Max Files Limit

```tsx
<FileUpload.Root
  multiple
  maxFiles={5}
  onError={(error) => console.error(error.message)}
>
  <FileUpload.Dropzone />
</FileUpload.Root>
```

---

## API Reference

### FileUpload.Root

| Prop            | Type                                | Default | Description                  |
| --------------- | ----------------------------------- | ------- | ---------------------------- |
| `value`         | `FileUploadFile[]`                  | -       | Controlled files state       |
| `defaultValue`  | `FileUploadFile[]`                  | `[]`    | Default files (uncontrolled) |
| `onValueChange` | `(files: FileUploadFile[]) => void` | -       | Called when files change     |
| `accept`        | `string`                            | -       | Accepted file types          |
| `multiple`      | `boolean`                           | `false` | Allow multiple files         |
| `maxSize`       | `number`                            | -       | Max file size in bytes       |
| `maxFiles`      | `number`                            | -       | Max number of files          |
| `disabled`      | `boolean`                           | `false` | Disable the upload           |
| `onError`       | `(error: FileUploadError) => void`  | -       | Validation error callback    |

### FileUpload.Dropzone

| Prop                 | Type                        | Default                             | Description          |
| -------------------- | --------------------------- | ----------------------------------- | -------------------- |
| `size`               | `'sm' \| 'default' \| 'lg'` | `'default'`                         | Dropzone size        |
| `dropzoneText`       | `string`                    | `'Paste Or Drag & Drop Files Here'` | Dropzone text        |
| `browseText`         | `string`                    | `'Browse for files'`                | Browse button text   |
| `hideDefaultContent` | `boolean`                   | `false`                             | Hide default content |

### Types

```tsx
interface FileUploadFile {
  id: string;
  file: File;
  progress?: number;
  status?: "idle" | "uploading" | "success" | "error";
  preview?: string;
}

interface FileUploadError {
  type: "file-too-large" | "too-many-files" | "invalid-type";
  message: string;
  files?: File[];
}
```

---

## Accessibility

- Keyboard navigation with Enter/Space to open file picker
- `aria-live` announcements for file selections and errors
- Proper ARIA attributes on all interactive elements
- Focus management and visible focus indicators
- Screen reader instructions for usage

---

## Best Practices

- **Provide clear constraints**: Display accepted types and size limits
- **Show progress**: Use `ItemProgress` for upload feedback
- **Handle errors**: Implement `onError` for user-friendly messages
- **Preview images**: The component auto-generates previews for images
- **Clean up**: Previews are automatically cleaned up on unmount
